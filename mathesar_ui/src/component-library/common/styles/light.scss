// ********************************************
// LIGHT MODE
// ********************************************

// Utility functions
@function adjust-lightness($color, $delta) {
  @if type-of($delta) == "number" {
    @if $delta > 0 {
      @return lighten($color, $delta);
    } @else {
      @return darken($color, abs($delta));
    }
  } @else {
    @warn "adjust-lightness() expects a numeric percentage, got #{$delta}";
    @return $color;
  }
}

// ------------------------------------------
// Base color
// ------------------------------------------

$base-hue: 42;
$base-sat: 5%;

// ------------------------------------------
// Surfaces
// ------------------------------------------

// Colors, ordered by elevation / lightness
$surface-colors: (
  "inset": hsl($base-hue, $base-sat, 99%),
  "input": hsl($base-hue, $base-sat, 100%),
  "base": hsl($base-hue, $base-sat, 97%),
  "card": hsl($base-hue, $base-sat, 98%),
  "canvas": hsl($base-hue, $base-sat, 95%),
  "supporting": hsl($base-hue, $base-sat, 98%),
  "fieldset": hsl($base-hue, $base-sat, 93%),
  "header": hsl($base-hue, $base-sat, 92%),
  "control": hsl($base-hue, $base-sat, 92%),
  "elevated-low": hsl($base-hue, $base-sat, 92%),
  "elevated-mid": hsl($base-hue, $base-sat, 90%),
  "elevated-high": hsl($base-hue, $base-sat, 88%),
  "elevated-top": hsl($base-hue, $base-sat, 85%),
  "token": hsl($base-hue, $base-sat, 75%),
  "input-fill": hsl(212, 84%, 44.1%),
  "light": hsl($base-hue, $base-sat, 100%)
);

$surface-states: (
  "hover": (0, 0%, -7%),
  "active": (0, 0%, -9%),
  "focused": (0, 0%, -2%),
  "disabled": (0, 0%, -20%),
  "muted": (0, 0%, 10%)
);

// Token generator mixin
@mixin generate-surface-tokens($prefix, $base-color, $states) {
  --SYS-surface-#{$prefix}: #{$base-color};
  @each $state, $delta in $states {
    $dh: nth($delta, 1);
    $ds: nth($delta, 2);
    $dl: nth($delta, 3);
    $h-new: (hue($base-color) + $dh) % 360;
    $s-new: max(0%, min(100%,  saturation($base-color) + $ds));
    $l-new: max(0%, min(100%,  lightness($base-color) + $dl));
    $variant: hsl($h-new, $s-new, $l-new);
    --SYS-surface-#{$prefix}-#{$state}: #{$variant};
  }
}

// ------------------------------------------
// Borders
// ------------------------------------------

// Ordered by lightnesss. 
// Although some tokens have the same values, they're defined separately for modularity.
$border-colors: (
  "container": hsl($base-hue, $base-sat, 12%),
  "row": hsl($base-hue, $base-sat, 12%),
  "shadow": hsl($base-hue, $base-sat, 12%),
  "grid": hsl($base-hue, $base-sat, 15%),
  "card": hsl($base-hue, $base-sat, 15%),
  "dropdown": hsl($base-hue, $base-sat, 15%),
  "divider": hsl($base-hue, $base-sat, 20%),
  "elevated-low": hsl($base-hue, $base-sat, 20%),
  "header": hsl($base-hue, $base-sat, 20%),
  "control": hsl($base-hue, $base-sat, 20%),
  "elevated-mid": hsl($base-hue, $base-sat, 25%),
  "fieldset": hsl($base-hue, $base-sat, 25%),
  "input": hsl($base-hue, $base-sat, 25%),
  "elevated-high": hsl($base-hue, $base-sat, 30%),
  "section": hsl($base-hue, $base-sat, 30%),
  "token": hsl($base-hue, $base-sat, 40%)
);

$border-states: (
  "hover": (0, 0%, 6%),
  "active": (0, 0%, 14%),
  "focused": (0, 0%, 10%)
);

// Token generator mixin
@mixin generate-border-tokens($prefix, $base-color, $states) {
  --SYS-border-#{$prefix}: #{$base-color};
  @each $state, $delta in $states {
    $dh: nth($delta, 1);
    $ds: nth($delta, 2);
    $dl: nth($delta, 3);
    $h-new: (hue($base-color) + $dh) % 360;
    $s-new: max(0%, min(100%,  saturation($base-color) + $ds));
    $l-new: max(0%, min(100%,  lightness($base-color) + $dl));
    $variant: hsl($h-new, $s-new, $l-new);
    --SYS-border-#{$prefix}-#{$state}: #{$variant};
  }
}

// ------------------------------------------
// Text
// ------------------------------------------

$text-colors: (
  "code": hsl(32, 80%, 4%),
  "control": hsl(32, 80%, 5%),
  "disabled": hsl($base-hue, 35%, 2%),
  "faint": hsl($base-hue, 15%, 1%),
  "header": hsl($base-hue, 92%, 5%),
  "highlight": hsl(59, 90%, 84%),
  "highlight-elevated": hsl(59, 52%, 98%),
  "navigation": hsl($base-hue, 85%, 8%),
  "icon": hsl(220, 55%, 10%),
  "input": hsl($base-hue, 95%, 10%),
  "label": hsl($base-hue, 70%, 4%),
  "inverted": hsl($base-hue, 10%, 4%),
  "link": hsl(220, 60%, 50%),
  "muted": hsl($base-hue, 45%, 2%),
  "primary": hsl(32, 80%, 12%),
  "secondary": hsl(32, 65%, 4%),
  "tertiary": hsl($base-hue, 60%, 3%),
  "token": hsl($base-hue, 85%, 4%),
  "tooltip": hsl($base-hue, 88%, 4%)
);

$text-states: (
  "hover": (0, 0%, 12%),
  "active": (0, 0%, 18%)
);

// Token generator mixin
@mixin generate-text-tokens($prefix, $base-color, $states) {
  --SYS-text-#{$prefix}: #{$base-color};
  @each $state, $delta in $states {
    $dh: nth($delta, 1);
    $ds: nth($delta, 2);
    $dl: nth($delta, 3);
    $h-new: (hue($base-color) + $dh) % 360;
    $s-new: max(0%, min(100%,  saturation($base-color) + $ds));
    $l-new: max(0%, min(100%,  lightness($base-color) + $dl));
    $variant: hsl($h-new, $s-new, $l-new);
    --SYS-text-#{$prefix}-#{$state}: #{$variant};
  }
}

// ------------------------------------------
// Utility boxes + buttons
// ------------------------------------------

$semantic-families: (
  "success": (145, 40%),
  "warning": (50, 40%),
  "danger": (8, 40%),
  "info": (215, 40%),
  "help": (185, 40%),
  "tip": (150, 40%),
  "outcome": (275, 40%)
);

$semantic-roles: (
  "bg": (1.0, 85%),
  "text": (1.0, 30%),
  "icon": (1.0, 35%),
  "border": (0.8, 80%),
  "button-bg": (0.4, 92%),
  "button-text": (1, 32%),
  "button-icon": (1.0, 32%),
  "button-border": (0.6, 84%)
);

$semantic-states: (
  "hover": (3%, -3%, 0),
  "active": (6%, 0%, 0),
  "focused": (3%, -5%, -5)
);

@mixin generate-semantic-tokens($name, $hue, $sat, $roles) {
   @each $role, $params in $roles {
      $sat-mult: nth($params, 1);
      $l: nth($params, 2);
      $s: $sat * $sat-mult;
      $color: hsl($hue, $s, $l);
      --SYS-semantic-#{$name}-#{$role}: #{$color};
      @each $state, $delta in $semantic-states {
        $dl: nth($delta, 1);
        $ds: nth($delta, 2);
        $dh: nth($delta, 3);
        $sh: max(0%, min(100%, $s + $ds));
        $lh: max(0%, min(100%, $l + $dl));
        $hh: ($hue + $dh) % 360;
        $variant: hsl($hh, $sh, $lh);
        --SYS-semantic-#{$name}-#{$role}-#{$state}: #{$variant};
      }
   }
}


// ------------------------------------------
// Accents
// ------------------------------------------

$accent-families: (
  "tomato": (8, 60%),
  "pumpkin": (33, 90%),
  "amethyst": (270, 35%),
  "salmon": (12, 79%),
  "wisteria": (250, 35%),
  "glacier": (190, 35%),
  "asparagus": (90, 45%),
  "fjord": (220, 30%)
);

$accent-roles: (
  "base": (1.0, 50%),
  "faint": (1.0, 95%),
  "muted": (1.0, 85%),
  "dull": (1.0, 70%),
  "bright": (1.0, 25%),
  "contrast": (1.0, 15%),
  "inverted": (1.0, 5%)
);

$accent-states: (
  "hover": (-3%, 3%, 0),
  "active": (-6%, 0%, 0),
  "focused": (-3%, 5%, 5),
  "muted": (5%, -20%, 0),
  "highlighted": (-4%, 8%, -10)
);

// Token generator mixin
@mixin generate-accent-tokens($name, $hue, $sat, $roles) {
  @each $role, $params in $roles {
    $sat-mult: nth($params, 1);
    $l: nth($params, 2);
    $s: $sat * $sat-mult;
    $color: hsl($hue, $s, $l);
    --SYS-accent-#{$name}-#{$role}: #{$color};
    @each $state, $delta in $accent-states {
      $dl: nth($delta, 1);
      $ds: nth($delta, 2);
      $dh: nth($delta, 3);
      $sh: max(0%, min(100%, $s + $ds));
      $lh: max(0%, min(100%, $l + $dl));
      $hh: ($hue + $dh) % 360;
      $variant: hsl($hh, $sh, $lh);
      --SYS-accent-#{$name}-#{$role}-#{$state}: #{$variant};
    }
  }
}


// ------------------------------------------
// GENERATE COLORS FOR THEME
// ------------------------------------------
body {
  // Surfaces
  @each $name, $color in $surface-colors {
    @include generate-surface-tokens(#{$name}, $color, $surface-states);
  }

  // Borders
  @each $name, $color in $border-colors {
    @include generate-border-tokens(#{$name}, $color, $border-states);
  }

  // Text
  @each $name, $color in $text-colors {
    @include generate-text-tokens(#{$name}, $color, $text-states);
  }

  // Semantic colors
  @each $name, $props in $semantic-families {
    $hue: nth($props, 1);
    $sat: nth($props, 2);
    @include generate-semantic-tokens($name, $hue, $sat, $semantic-roles);
  }

  // Accent colors
  @each $name, $props in $accent-families {
    $hue: nth($props, 1);
    $sat: nth($props, 2);
    @include generate-accent-tokens($name, $hue, $sat, $accent-roles);
  }
}
